<!DOCTYPE html>
<html lang="en">
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>巡检任务统计</title>
    <link type="text/css" href="webjars/bootstrap" th:href="@{/webjars/bootstrap/3.3.7/css/bootstrap.css}"
          rel="stylesheet">

    <!--//<script src="js/jquery.form.js" type="text/javascript"></script>-->
    <link rel="stylesheet" type="text/css" href="css/ShowPage.css"/>
    <script th:src="@{/webjars/jquery/3.4.1/jquery.js}"></script>
    <script th:src="@{/webjars/bootstrap3.3.7/js/bootstrap.js}"></script>
    <script src="js/jsform.js" type="text/javascript"></script>
    <link rel="stylesheet" href="css/datepicker.css">
    <script src="js/moment.js"></script>
    <script src="js/datepicker.js"></script>
    <script src="js/date.js"></script>
    <!--    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.form/4.2.2/jquery.form.min.js" integrity="sha384-FzT3vTVGXqf7wRfy8k4BiyzvbNfeYjK+frTVqZeNDFl8woCbF0CYG6g2fMEFFo/i" crossorigin="anonymous"></script>-->
    <style>
        #van {
            padding: 30px 50px 20px 20px;
        }

        .form-control {
            width: 200px;
        }

        .input-group {
            margin: 5px;
        }

        .input-group-addon {
            width: 90px;
        }

        td,th {
            text-align: center;
        }
    </style>
</head>
<body>

<p id="van">
    <span>信息统计</span>
    <span>&gt;&gt;&nbsp;</span>
    <span>巡检记录统计</span>
</p>

<!-------筛选------->
<div class="row " style="padding: 0px 50px 50px 50px">
    <form id="su">
        <div class="col-lg-9 col-sm-9 col-xs-9 ">
            <div class="col-lg-4 col-sm-6 col-xs-12">
                <div class="input-prepend input-group">
                    <span class="add-on input-group-addon" style="">任务编号:</span>
                    <input type="text" name="checkJobNo" id="checkJobNo" class="form-control" value="">
                </div>
            </div>
            <div class="col-lg-4 col-sm-6 col-xs-12 ">
                <div class="input-prepend input-group">
                    <span class="add-on input-group-addon">线路编号:</span>
                    <input type="text" name="circuitNo" id="circuitNo" class="form-control" value="">
                </div>
            </div>
            <div class="col-lg-4 col-sm-6 col-xs-12 ">
                <div class="input-prepend input-group">
                    <span class="add-on input-group-addon">发现时间:</span>

                    <div class="  J-datepicker-range-day  form-control date" style="width: 200px">
                        <input placeholder="开始日期" name="startTime" class="c-datepicker-data-input only-date"
                               style="width: 77px">
                        <span class="c-datepicker-range-separator">-</span>
                        <input placeholder="结束日期" name="endTime" class="c-datepicker-data-input only-date"
                               style="width: 77px">
                    </div>
                </div>
            </div>
            <div class="col-lg-4 col-sm-6 col-xs-12 ">
                <input hidden="hidden" name="pageIndex" id="pageIndex" value="1">
                <input hidden="hidden" name="pageSize" id="pageSize" value="4">
                <button type="submit"  class="btn btn-primary btn-regist">查询</button>
                <input hidden="hidden" id="pageCount" value="10">
            </div>
        </div>
    </form>
</div>





<div class="row">
    <!-- lh表格 -->
    <div class="row" style="padding: 10px 50px 50px 65px">
        <div class="col-sm-12">
            <table id="datatable" class="table table-striped table-bordered dataTable no-footer" role="grid"
                   aria-describedby="datatable_info" style="text-align: center">
                <thead>
                <tr role="row" >

                    <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1"
                        aria-label="Position: activate to sort column ascending" style="width: 141px;text-align: center">任务编号
                    </th>
                    <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1"
                        aria-label="Position: activate to sort column ascending" style="width: 161px;text-align: center">任务名称
                    </th>
                    <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1"
                        aria-label="Position: activate to sort column ascending" style="width: 260px;text-align: center">线路编号(起始杆号-终止杆号)
                    </th>
                    <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1"
                        aria-label="Position: activate to sort column ascending" style="width: 161px;text-align: center">杆塔编号
                    </th>
                    <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1"
                        aria-label="Position: activate to sort column ascending" style="width: 181px;text-align: center">缺陷级别
                    </th>
                    <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1"
                        aria-label="Position: activate to sort column ascending" style="width: 181px;text-align: center">缺陷类型
                    </th>
                    <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1"
                        aria-label="Office: activate to sort column ascending" style="width: 161px;text-align: center">发现时间
                    </th>
                    <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1"
                        aria-label="Office: activate to sort column ascending" style="width: 230px;text-align: center">缺陷描述
                    </th>
                </tr>
                </thead>

                <tbody id="app">

                </tbody>
            </table>
        </div>
    </div>
</div>
<div class="zxf_pagediv">

</div>
</body>
</html>
<!--<script src="js/StatisticsPage.js" type="text/javascript"></script>-->
<script src="js/ShowPage.js" type="text/javascript"></script>
<script type="text/javascript">
    function submint() {
        $("#su").ajaxSubmit({
            type: "post",  //提交方式
            dataType: "json", //数据类型
            async:false,
            url: "checkList.html", //请求url
            success: function (data) {//提交成功的回调函数
                $("#pageCount").val(data.pageSurpport.pageCount);
                var options=""
                $.each(data.pageSurpport.dataList, function (i, obj) {
                    var statusStr="";
                    var checkJobNo = obj.checkJobNo == null ? "" : obj.checkJobNo;
                    var checkJobName="";
                    var circuitNo = obj.circuitNo == null ? "" : obj.circuitNo;
                    var towerNo = obj.towerNo == null ? "" : obj.towerNo;
                    var flawLv = obj.flawLv == null ? "" : obj.flawLv;
                    var flawName="";
                    var comment = obj.comment == null ? "" : obj.comment;
                    var checkDate = obj.checkDate == null ? "" : obj.checkDate;
                    $.each(data.flawtypeList,function (i,obj2) {
                        if(obj2.flawTypeId==obj.flawTypeId){
                    flawType=obj2.flawName;
                        }
                    })
                    $.each(data.checktaskinfoList,function (i,obj3) {
                        if(obj3.jobId==obj.checkJobNo){
                            checkJobName=obj3.jobName;
                            circuitNo+="("+obj3.startNo+"-"+obj3.stopNo+")";
                        }
                    })
                    options+=
                        "<tr style='vertical-align: middle'><td>"+checkJobNo+"</td>"+
                        "<td>"+checkJobName+"</td>"+
                        "<td>"+circuitNo+"</td>"+
                        "<td>"+towerNo+"</td>"+
                        "<td>"+flawLv+"</td>"+
                        "<td>"+flawName+"</td>"+
                        "<td>"+checkDate+"</td>"+
                        "<td>"+comment+"</td>"+
                        "</tr>";
                });
                $("#app").html(options);
                $(".zxf_pagediv").createPage({
                    pageNum:$("#pageCount").val(),
                    current:1,
                    backfun: function(e) {
                    }
                });
            }
        });
        return false; //不刷新页面
    }


    $(function () {
        submint();
        $("#su").submit(function () {
            submint();
            return false;
        });
        $(document).on("click", "a.zxfPagenum", function () {
            var cur = parseInt($(this).text());
            $("#pageIndex").val(cur);
            submint();
        });
        $(document).on("click", "a.prebtn", function () {
            var cur = parseInt($("span.current").text());
            $("#pageIndex").val(cur);
            submint();
        });
        $(document).on("click", "a.nextbtn", function () {
            var cur = parseInt($("span.current").text());
            $("#pageIndex").val(cur);
            submint();
        });

        $(document).on("click","span.zxfokbtn",function(){
            var cur = parseInt($("input.zxfinput").text());
            alert(cur);
            $("#pageIndex").val(cur);
            if(cur>$("#pageCount").val()){return;}
            submint();
        });

    })
</script>